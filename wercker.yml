# box: mikewhy/selenium-cucumber
# build:
#   steps:
#     - bundle-install
#     - rails-database-yml

#     - script:
#         name: setup database
#         code: bundle exec rake db:create db:migrate RAILS_ENV=test

#     - script:
#         name: rspec
#         code: bundle exec rspec

# deploy:
#   steps:
#     - heroku-deploy:
#         key-name: DEPLOYMENT_KEY
#         install-toolbelt: true
#         retry: true
#         run: rake db:migrate

#         - npm-install
#         - npm-test


box: wercker/nodejs
services:
  - postgres
build:
  steps:
    - script:
        name: install xvfb, firefox
        code: sudo apt-get install xvfb firefox
    - script:
        name: install selenium wrapper
        code: sudo npm i -g selenium-standalone@2.43 # 2.44 is bugged
    - script:
        name: start selenium
        code: xvfb-run start-selenium > /dev/null & # Sleep needed?
    
    - bundle-install
    - rails-database-yml
    - npm-install
    - npm-test